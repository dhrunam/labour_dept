import{a as oe}from"./chunk-3K4VT3EW.js";import{a as ae}from"./chunk-BU6CDFS7.js";import{a as le}from"./chunk-VJZKEY6R.js";import{a as ie}from"./chunk-23FW255D.js";import{a as G}from"./chunk-Q4HGOK7L.js";import{a as ne}from"./chunk-24J74U5Z.js";import{a as P,b as z,c as H,d as J,e as K,f as W,g as X,h as Y,i as Z,j as ee,l as te}from"./chunk-LZEWMCEB.js";import{a as L}from"./chunk-DNLRMMXQ.js";import{b as $,g as Q}from"./chunk-BH5IOZ3E.js";import{k as U,o as q}from"./chunk-MN44VEXJ.js";import{Da as I,Ga as s,Ha as u,M as V,R as j,Wa as b,X as A,Ya as c,ab as v,bb as x,cb as E,da as _,db as w,ea as f,eb as n,fb as t,gb as m,jb as y,lb as h,mb as p,ob as N,pb as F,qb as R,rb as D,sb as a,tb as M,ub as k,xb as B,zb as O}from"./chunk-EN6TLIPF.js";import"./chunk-CGT2X6C5.js";var re=(()=>{let r=class r{constructor(i){this.http=i}verify_t2(i){return this.http.patch(`${L}/api/application/establishment/${i.get("id")}`,i)}reject_by_level1(i){return this.http.patch(`${L}/api/application/establishment/${i.get("id")}`,i)}};r.\u0275fac=function(l){return new(l||r)(j($))},r.\u0275prov=V({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var pe=["closeBtn"],ue=(o,r)=>({"btn-primary":o,"btn-danger":r});function _e(o,r){if(o&1&&(n(0,"span")(1,"a",37),a(2,"View"),t()()),o&2){let d=p();s(),c("href",d.details&&d.details.registration_certificate,I)}}function fe(o,r){if(o&1&&(n(0,"option",43),a(1),t()),o&2){let d=r.$implicit;c("value",d.id),s(),M(d.district_name)}}function ve(o,r){if(o&1&&(n(0,"option",43),a(1),t()),o&2){let d=r.$implicit;c("value",d.id),s(),M(d.office)}}function he(o,r){o&1&&(m(0,"span",52),n(1,"span",53),a(2,"Loading..."),t())}function ge(o,r){o&1&&a(0," Submit ")}function be(o,r){if(o&1){let d=y();n(0,"form",31,3),h("ngSubmit",function(){_(d);let l=D(1),e=p();return f(e.upload_old_registration_certificate(l))}),n(2,"div",8)(3,"div",38)(4,"h5"),a(5,"Applying To"),t(),n(6,"span")(7,"strong"),a(8,"Note:"),t(),a(9," Fields marked with ("),n(10,"span",39),a(11,"*"),t(),a(12,") are mandatory"),t()(),m(13,"hr"),n(14,"div",9)(15,"div",40)(16,"label",11),a(17,"District"),n(18,"span",39),a(19,"*"),t()(),n(20,"select",41,4),h("change",function(l){_(d);let e=p();return f(e.onDistrictChange(l))}),n(22,"option",42),a(23,"---Select District---"),t(),E(24,fe,2,2,"option",43,x),t()(),n(26,"div",40)(27,"label",44),a(28,"Applied to Office"),n(29,"span",39),a(30,"*"),t()(),n(31,"select",45,5)(33,"option",42),a(34,"---Select Office---"),t(),E(35,ve,2,2,"option",43,x),t()()()(),n(37,"div",46)(38,"div",47)(39,"label",48),a(40," Upload Old Registration Certificate "),n(41,"span",39),a(42,"*"),t()(),n(43,"div",49)(44,"input",50,6),h("change",function(l){_(d);let e=p();return f(e.tradeLicenceUpload(l))}),t()(),n(46,"div",49)(47,"button",51),b(48,he,3,0)(49,ge,1,0),t()()()()()}if(o&2){let d=p();s(24),w(d.districts),s(11),w(d.offices),s(12),c("disabled",d.showLoader),s(),v(48,d.showLoader?48:49)}}function Se(o,r){if(o&1){let d=y();n(0,"div",54)(1,"button",55),h("click",function(){_(d);let l=p(2);return f(l.fetch_status("rejected"))}),a(2,"Reject"),t(),n(3,"button",56),h("click",function(){_(d);let l=p(2);return f(l.fetch_status("approved"))}),a(4,"Approve"),t()()}}function ye(o,r){if(o&1&&b(0,Se,5,0,"div",54),o&2){let d=p();v(0,d.details&&d.details.application_status!=="approved"&&d.details.application_status!=="rejected"?0:-1)}}function Ce(o,r){o&1&&(m(0,"span",52),n(1,"span",53),a(2,"Loading..."),t())}function xe(o,r){if(o&1&&a(0),o&2){let d=p();k(" ",d.status==="approved"?"Approve":"Reject"," ")}}var Re=(()=>{let r=class r{constructor(i,l,e,g,T,C,se,de){this.print=i,this.recordService=l,this.route=e,this.localStorageService=g,this.toastr=T,this.officeService=C,this.districtService=se,this.detailService=de,this.showLoader=!1,this.instance_id=0,this.offices=[],this.districts=[],this.status="",this.displayStatus="",this.role={showGeneralUser:this.localStorageService.getDetails().related_group.some(S=>S.name==="general_user"),showLevel1Admin:this.localStorageService.getDetails().related_group.some(S=>S.name==="level1_dept_admin"),showLevel2Admin:this.localStorageService.getDetails().related_group.some(S=>S.name==="level2_dept_admin")}}ngOnInit(){this.route.params.subscribe({next:i=>{this.getDetails(i.id),this.instance_id=i.id,console.log("showLevel2Admin:"),console.log(this.role.showLevel2Admin)}}),this.get_districts()}getDetails(i){this.recordService.get_application(i).subscribe({next:l=>{this.details=l}})}upload_old_registration_certificate(i){if(this.status="received",!i.valid)i.control.markAllAsTouched();else{this.showLoader=!0;let l=new FormData;l.append("id",this.instance_id.toString()),l.append("registration_certificate",this.trade_licence),l.append("district",i.value.district),l.append("applied_office_details",i.value.office),l.append("application_status",this.status),this.recordService.patch_application(l).subscribe({next:e=>{this.details=e}})}}tradeLicenceUpload(i){i.target.files&&(this.trade_licence=i.target.files[0])}get_offices(i){this.officeService.get_all_by_district(i).subscribe({next:l=>{this.offices=l}})}onDistrictChange(i){let l=i.target.value;this.get_offices(l)}get_districts(){this.districtService.get_districts().subscribe({next:i=>{this.districts=i.results}})}fetch_status(i){this.status=i,this.displayStatus=i==="approved"?"approve":"reject"}verify_t2_application(i){this.showLoader=!0;let l=new FormData;l.append("id",this.instance_id.toString()),l.append("application_status",this.status),l.append("remarks",i.value.remarks),console.log("Remarks:"),console.log(i.value.remarks),this.recordService.patch_application(l).subscribe({next:e=>{this.details=e,this.showLoader=!1,this.getDetails(this.instance_id),this.closeBtn.nativeElement.click(),this.toastr.success("Success!","Data submitted sucessfully..!")},error:e=>{this.toastr.error("Sorry!","Something went wrong. Please try again..!")}})}};r.\u0275fac=function(l){return new(l||r)(u(le),u(oe),u(Q),u(G),u(ie),u(ne),u(ae),u(re))},r.\u0275cmp=A({type:r,selectors:[["app-details"]],viewQuery:function(l,e){if(l&1&&N(pe,7),l&2){let g;F(g=R())&&(e.closeBtn=g.first)}},standalone:!0,features:[B],decls:92,vars:24,consts:[["closeBtn",""],["level2","ngForm"],["remarks","ngModel"],["upload_old_certificate","ngForm"],["district","ngModel"],["office","ngModel"],["trade_licence","ngModel"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],[1,"applying"],[1,"row","g-3"],[1,"col-12","col-md-3"],[1,"form-label"],["type","text","name","registration_number","disabled","",1,"form-control",3,"ngModel"],[1,"col-12","col-lg-3","col-md-4"],["type","text","name","full_name","disabled","",1,"form-control","shadow-none",3,"value"],["type","text","name","establishment_name","disabled","",1,"form-control",3,"ngModel"],[1,"details","mt-3"],["type","text","name","establishment_address","disabled","",1,"form-control","shadow-none",3,"value"],["type","text","name","district","disabled","",1,"form-control",3,"ngModel"],["type","text","name","name_employer","disabled","",1,"form-control","shadow-none",3,"value"],["type","text","name","name_manager","disabled","",1,"form-control","shadow-none",3,"value"],[1,"row","g-3","mt-2"],[1,"col-12","col-md-6"],["type","text","disabled","",1,"form-control",3,"value"],["type","text","disabled","",1,"form-control","shadow-none",3,"value"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[3,"ngSubmit"],[1,"modal-body"],[1,"col-6"],["type","text","name","remarks","required","",1,"form-control",3,"ngModel"],[1,"modal-footer"],["type","submit",1,"btn",3,"disabled","ngClass"],["target","_blank",3,"href"],[1,"d-flex","justify-content-between","align-items-center"],[1,"text-danger"],[1,"col-12","col-md-4"],["name","district","ngModel","","required","",1,"form-select","shadow-none",3,"change"],["value",""],[3,"value"],["for","office",1,"form-label"],["name","office","ngModel","","required","",1,"form-select"],[1,"additional","mt-3","mb-5"],[1,"row"],["for","",1,"form-label"],[1,"col-6","col-md-4"],["type","file","name","trade_licence","ngModel","","required","",1,"form-control","shadow-none",3,"change"],["type","submit",1,"btn","btn-primary",3,"disabled"],["aria-hidden","true",1,"spinner-border","spinner-border-sm"],["role","status"],[1,"mt-4","mb-5","text-end"],["data-bs-toggle","modal","data-bs-target","#exampleModal",1,"btn","btn-danger",3,"click"],["data-bs-toggle","modal","data-bs-target","#exampleModal",1,"btn","btn-primary","ms-3",3,"click"]],template:function(l,e){if(l&1){let g=y();n(0,"header",7)(1,"h4"),a(2,"Details"),t()(),m(3,"hr"),n(4,"div",8)(5,"div",9)(6,"div",10)(7,"label",11),a(8,"Registration No."),t(),m(9,"input",12),t(),n(10,"div",13)(11,"label",11),a(12,"Date of Registration"),t(),m(13,"input",14),t(),n(14,"div",10)(15,"label",11),a(16,"Establishment Name"),t(),m(17,"input",15),t(),n(18,"div",13)(19,"label",11),a(20,"Registration Certificate"),t(),m(21,"br"),b(22,_e,3,1,"span"),t()()(),n(23,"div",16)(24,"div",9)(25,"div",13)(26,"label",11),a(27,"Address"),t(),m(28,"input",17),t(),n(29,"div",10)(30,"label",11),a(31,"District"),t(),m(32,"input",18),t(),n(33,"div",13)(34,"label",11),a(35,"Name of Employer"),t(),m(36,"input",19),t(),n(37,"div",13)(38,"label",11),a(39,"Name of Manager"),t(),m(40,"input",20),t()(),n(41,"div",21)(42,"div",22)(43,"label",11),a(44,"Category of Establishment"),t(),m(45,"input",23),t(),n(46,"div",22)(47,"label",11),a(48,"Nature of Business"),t(),m(49,"input",24),t()(),n(50,"div",21)(51,"div",22)(52,"label",11),a(53,"Number of Male Employee"),t(),m(54,"input",23),t(),n(55,"div",22)(56,"label",11),a(57,"Number of Female Employee"),t(),m(58,"input",24),t()(),n(59,"div",21)(60,"div",22)(61,"label",11),a(62,"Status"),t(),m(63,"input",23),t(),n(64,"div",22)(65,"label",11),a(66,"Remarks"),t(),m(67,"input",24),t()()(),b(68,be,50,2,"form")(69,ye,1,1),n(70,"div",25)(71,"div",26)(72,"div",27)(73,"div",28)(74,"h1",29),a(75,"Alert"),t(),m(76,"button",30,0),t(),n(78,"form",31,1),h("ngSubmit",function(){_(g);let C=D(79);return f(e.verify_t2_application(C))}),n(80,"div",32),a(81),m(82,"br"),n(83,"div",33)(84,"label",11),a(85,"Remarks"),t(),m(86,"input",34,2),t()(),n(88,"div",35)(89,"button",36),b(90,Ce,3,0)(91,xe,1,1),t()()()()()()}l&2&&(s(9),c("ngModel",e.details&&e.details.registration_number.replaceAll("-","/")),s(4),c("value",e.details&&e.details.date_of_registrations),s(4),c("ngModel",e.details&&e.details.establishment_name),s(5),v(22,e.details&&e.details.registration_certificate?22:-1),s(6),c("value",e.details&&e.details.establishment_address),s(4),c("ngModel",e.details&&e.details.district),s(4),c("value",e.details&&e.details.name_employer),s(4),c("value",e.details&&e.details.name_manager),s(5),c("value",e.details&&e.details.establishment_category),s(4),c("value",e.details&&e.details.nature_business),s(5),c("value",e.details&&e.details.total_emplyee_male),s(4),c("value",e.details&&e.details.total_emplyee_female),s(5),c("value",e.details&&e.details.application_status),s(4),c("value",e.details&&e.details.remarks),s(),v(68,e.role&&e.role.showGeneralUser&&e.details&&(e.details.registration_certificate===null||e.details.application_status=="rejected")?68:-1),s(),v(69,e.role&&(e.role.showLevel2Admin||e.role.showLevel1Admin)?69:-1),s(12),k(" Are you sure you want to ",e.displayStatus," ? "),s(5),c("ngModel",e.details&&e.details.remarks),s(3),c("disabled",e.showLoader)("ngClass",O(21,ue,e.status==="approved",e.status!=="approved")),s(),v(90,e.showLoader?90:91))},dependencies:[te,W,Y,Z,P,X,z,H,ee,K,J,q,U]});let o=r;return o})();export{Re as DetailsComponent};
